import{i as q,d as N}from"./index.3cfc26e3.js";import{W as S}from"./WpTable.5b32ebd5.js";import"./default-i18n.3a91e0e5.js";import"./constants.355a3bff.js";import{_ as T,r as u,o as r,h as v,w as f,f as o,g as P,d as b,t as h,e as R,c as g,a as p,x as j,n as I,F,i as K,K as Y,k as tt}from"./_plugin-vue_export-helper.49ea0e68.js";import"./SaveChanges.04870e44.js";import{C as B}from"./Tooltip.754dc940.js";import{C as L}from"./Table.edad123c.js";import{a as C,b as st,c as et}from"./Affiliate.bd403a25.js";import{c as E,C as nt}from"./index.d59f905b.js";import{P as x}from"./PostTypes.9ab32454.js";import{S as V}from"./Suggestion.88862488.js";import{a as D,m as U,d as it}from"./vuex.esm-bundler.ccdd8fb3.js";import{C as ot}from"./Tabs.2341d6cd.js";import{C as rt}from"./Index.20fccad8.js";import{S as lt,e as W,c as at}from"./Caret.09e548f3.js";import{B as ut}from"./Editor.c126da5a.js";import{T as z}from"./Slide.dcb3da9d.js";import{S as G}from"./Plus.77736cd8.js";const A=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),We={methods:{filteredSuggestionsOutbound(t){const s=t.links.suggestionsOutbound.rows,n=[];return s.forEach(l=>{this.editorIsSuggestionAlreadyAdded(l)||n.push(l)}),n},editorIsSuggestionAlreadyAdded(t){return q()?this.blockEditorIsSuggestionAlreadyAdded(t):N()?this.classicEditorIsSuggestionAlreadyAdded(t):!1},blockEditorIsSuggestionAlreadyAdded(t){const s=window.wp.data.select("core/block-editor").getBlocks();return s?this.doesBlockHaveLink(s,t):!1},doesBlockHaveLink(t,s){let n=!1;return t.forEach(l=>{n||!l.attributes||s.suggestions.forEach(e=>{const i=A(e.context.permalink.trim()),k=new RegExp(`(<a href="${i}"[^<>]*>)(.*)(</a[^<>]*>)`,"i");if(l.attributes.content&&l.attributes.content.search(k)!==-1){n=!0;return}if(!l.innerBlocks)return;this.doesBlockHaveLink(l.innerBlocks,s)&&(n=!0)})}),n},classicEditorIsSuggestionAlreadyAdded(t){let s="",n=null,l=null;if(document.querySelector("#wp-content-wrap.tmce-active")?(n=window.tinyMCE.get("content"),s=n.getContent({format:"raw"})):(l=document.querySelector("textarea#content"),s=l?l.value:""),!s)return!1;let e=!1;return t.suggestions.forEach(i=>{const k=A(i.context.permalink.trim()),c=new RegExp(`(<a href="${k}"[^<>]*>)(.*)(</a[^<>]*>)`,"i");s.search(c)!==-1&&(e=!0)}),e}}},Z={methods:{findTargetBlock(t,s){const n=A(s);let l=null;return t.forEach(e=>{if(l||!e.attributes)return;if(e.attributes.content&&e.attributes.content.search(n)!==-1){l=e.clientId;return}if(!e.innerBlocks)return;const i=this.findTargetBlock(e.innerBlocks,s);i&&(l=i)}),l}}},O={emits:["updatingLinks","linksUpdated"],mixins:[Z],props:{post:{type:Object,required:!0},postIndex:{type:Number,required:!1},postId:{type:Number,required:!1},linksReport:{type:Boolean,default(){return!1}},postReport:{type:Boolean,default(){return!1}},metabox:{type:Boolean,default(){return!1}}},beforeMount(){this.$bus.$on("updatingLinks",t=>{this.wpTableLoading=t}),this.pageNumber=this.linkType?this.linkAssistant.postReport[this.linkType].totals.page:1},data(){return{changeItemsPerPageSlug:"linkAssistantPostsReport",action:"",showModal:!1,selectedRows:[],bulkOptions:[{label:this.$t.__("Delete",this.$td),value:"delete"}],strings:{frontPage:this.$t.__("Front Page",this.$tdPro),deleteLink:this.$t.__("Delete Link",this.$tdPro)},modalStrings:{areYouSureSingle:this.$t.__("Are you sure you want to delete this link?",this.$tdPro),areYouSureMultiple:this.$t.__("Are you sure you want to delete these links?",this.$tdPro),areYouSureAll:this.$t.__("Are you sure you want to delete all links?",this.$tdPro),actionCannotBeUndone:this.$t.__("This action cannot be undone.",this.$tdPro),yesSingle:this.$t.__("Yes, I want to delete this link",this.$tdPro),yesMultiple:this.$t.__("Yes, I want to delete these links",this.$tdPro),yesAll:this.$t.__("Yes, I want to delete all links",this.$tdPro),noChangedMind:this.$t.__("No, I changed my mind",this.$tdPro)}}},computed:{...D(["linkAssistant","currentPost"]),rows(){if(!this.metabox)return this.post.links[this.linkType].rows;const t=this.pageNumber===1?0:(this.pageNumber-1)*10;return this.post.links[this.linkType].rows.slice(t,t+10)}},methods:{...U("linkAssistant",["linkDelete","linksBulk","fetchPostReport","fetchLinksReportInner","postSettingsUpdate"]),fetchData(t){this.$bus.$emit("updatingLinks",!0);const s={...t,additionalFilters:{postId:this.post.ID||this.currentPost.id,postIndex:this.postIndex,type:this.linkType}},n=this.postReport?"fetchPostReport":"fetchLinksReportInner";return this[n](s).finally(()=>{this.$bus.$emit("updatingLinks",!1)})},openPostReport(t){window.location.href=`#/post-report?postId=${this.postId}&postIndex=${this.postIndex}&initialTab=${t}`},maybeDoBulkAction({action:t,selectedRows:s}){s===!1||!t||(this.action=t,this.selectedRows=s,this.showModal=!0)},doBulkAction(){if(this.showModal=!1,!(this.selectedRows===!1||typeof this.selectedRows>"u")){if(typeof this.selectedRows=="number"){this.doDeleteLink(this.selectedRows);return}if(this.metabox&&this.linkType!=="inboundInternal"){this.idsToIndexes(this.selectedRows).forEach(s=>{this.editorRemoveLink(s)});return}this.$bus.$emit("updatingLinks",!0),this.linksBulk({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,action:this.action,linkType:this.linkType,linkIds:this.selectedRows,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated"),this.refreshTable()})}},doDeleteLink(t){const s=this.post.links[this.linkType].rows[t].id;if(s){if(this.metabox&&this.linkType!=="inboundInternal"){this.editorRemoveLink(t);return}this.$bus.$emit("updatingLinks",!0),this.linkDelete({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,linkId:s,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated"),this.refreshTable()})}},editorRemoveLink(t){q()&&(this.$bus.$emit("updatingLinks",!1),this.blockEditorRemoveLink(t),this.$bus.$emit("updatingLinks",!1)),N()&&this.classicEditorRemoveLink(t)},blockEditorRemoveLink(t){const s=this.currentPost.linkAssistant.links[this.linkType].rows[t];if(!s)return;this.$bus.$emit("updatingLinks",!0);const n=A(s.anchor.trim()),l=s.phrase_html.trim(),e=A(l),i=window.wp.data.select("core/block-editor").getBlocks(),k=this.findTargetBlock(i,l);if(!k){this.$bus.$emit("updatingLinks",!1);return}const c=window.wp.data.select("core/block-editor").getBlock(k);if(!c){this.$bus.$emit("updatingLinks",!1);return}let _=new RegExp(`(<t?a[^<>]*>)(.*)?(${n})(.*)?(</t?a[^<>]*>)`,"i");const m=l.replace(_,"$2$3$4");_=new RegExp(`${e}`,"i"),window.wp.data.dispatch("core/block-editor").updateBlockAttributes(k,{content:c.attributes.content.replace(_,m)}).then(()=>{this.post.links[this.linkType].rows.splice(t,1)}).catch(w=>{console.error(`Couldn	 delete link with type "${this.linkType}" and index ${t}:`,w)}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated")})},classicEditorRemoveLink(t){const s=this.currentPost.linkAssistant.links[this.linkType].rows[t];if(!s||!window.tinyMCE)return;this.$bus.$emit("updatingLinks",!0);let n="",l=null,e=null;if(document.querySelector("#wp-content-wrap.tmce-active")?(l=window.tinyMCE.get("content"),n=l.getContent({format:"raw"})):(e=document.querySelector("textarea#content"),n=e?e.value:""),!n){this.$bus.$emit("updatingLinks",!1);return}let i=s.phrase_html.trim();l||(i=i.replace(/(\sdata-mce-href=".*")/gi,""));const k=A(s.anchor.trim());let c=new RegExp(`(<t?a[^<>]*>)(.*)?(${k})(.*)?(</t?a[^<>]*>)`,"i");const _=i.replace(c,"$2$3$4"),m=A(i);c=new RegExp(`${m}`,"i"),n=n.replace(c,_),l?l.setContent(n):e.value=n,this.post.links[this.linkType].rows.splice(t,1),this.postSettingsUpdate({postContent:n}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated")})},idsToIndexes(t){let s,n=[];return Array.isArray(t)&&(s=t.map(Number)),s&&this.post.links[this.linkType].rows.forEach((l,e)=>{s.includes(l.id)&&n.push(e)}),t==="all"&&(n=this.post.links[this.linkType].rows.map((l,e)=>e)),n.sort(function(l,e){return e-l})}}};const dt={emits:["closeModal","doBulkAction"],components:{CoreModal:rt,SvgClose:lt},props:{selectedRows:{required:!0},strings:{type:Object,required:!0}},computed:{areYouSure(){return this.selectedRows==="all"?this.strings.areYouSureAll:Array.isArray(this.selectedRows)&&1<this.selectedRows.length?this.strings.areYouSureMultiple:this.strings.areYouSureSingle},confirmation(){return this.selectedRows==="all"?this.strings.yesAll:Array.isArray(this.selectedRows)&&1<this.selectedRows.length?this.strings.yesMultiple:this.strings.yesSingle}}},ht={class:"aioseo-modal-body"},pt=["innerHTML"];function gt(t,s,n,l,e,i){const k=u("svg-close"),c=u("base-button"),_=u("core-modal");return r(),v(_,{class:"aioseo-confirmation-modal","no-header":""},{body:f(()=>[o("div",ht,[o("button",{class:"close",onClick:s[1]||(s[1]=P(m=>t.$emit("closeModal",!0),["stop"]))},[b(k,{onClick:s[0]||(s[0]=m=>t.$emit("closeModal",!0))})]),o("h3",null,h(i.areYouSure),1),o("div",{class:"reset-description",innerHTML:n.strings.actionCannotBeUndone},null,8,pt),b(c,{type:"blue",size:"medium",onClick:s[2]||(s[2]=m=>t.$emit("doBulkAction",m))},{default:f(()=>[R(h(i.confirmation),1)]),_:1}),b(c,{type:"gray",size:"medium",onClick:s[3]||(s[3]=m=>t.$emit("closeModal",!0))},{default:f(()=>[R(h(n.strings.noChangedMind),1)]),_:1})])]),_:1})}const M=T(dt,[["render",gt]]);const ct={components:{CoreTooltip:B},props:{phrase:{type:String,required:!0},phraseHtml:{type:String,required:!0},anchor:{type:String,required:!0},url:{type:String,required:!0},tooltip:{type:Boolean,required:!1,default:!0},clickableAnchor:{type:Boolean,default(){return!1}}},computed:{partPattern(){const t=A(this.anchor);return new RegExp(`(.*)(<t?a[^>]*>.*${t}.*</t?a>)(.*)`,"i")},firstPart(){return this.stripTags(this.getPart(1))},linkAnchor(){return this.stripTags(this.getPart(2))},lastPart(){return this.stripTags(this.getPart(3))}},methods:{getPart(t){const s=this.phraseHtml.match(this.partPattern);return s?s[t]:""},stripTags(t){return t.replace(/(<([^>]+)>)/gi,"")},maybeOpenLink(){this.clickableAnchor&&window.open(this.url,"_blank").focus()}}},kt={class:"phrase"},mt={class:"first"},ft=["href"],bt={key:1},_t={class:"anchor"},$t={class:"last"};function wt(t,s,n,l,e,i){const k=u("core-tooltip");return r(),g("div",{class:"aioseo-link-assistant-phrase",onMouseover:s[1]||(s[1]=c=>t.$emit("mouseOver")),onMouseleave:s[2]||(s[2]=c=>t.$emit("mouseLeave"))},[o("span",kt,[o("span",mt,h(i.firstPart),1),n.tooltip?(r(),v(k,{key:0,type:"action"},{tooltip:f(()=>[o("a",{class:"tooltip-url",href:n.url,target:"_blank"},h(n.url),9,ft)]),default:f(()=>[o("span",{class:"anchor",onClick:s[0]||(s[0]=(...c)=>i.maybeOpenLink&&i.maybeOpenLink(...c))},h(i.linkAnchor),1)]),_:1})):p("",!0),n.tooltip?p("",!0):(r(),g("div",bt,[o("span",_t,h(i.linkAnchor),1)])),o("span",$t,h(i.lastPart),1)]),j(t.$slots,"icons")],32)}const H=T(ct,[["render",wt]]),vt={components:{CoreTooltip:B,CoreWpTable:L,LinkAssistantConfirmationModal:M,LinkAssistantPhrase:H,SvgLinkExternal:C,SvgTrash:E},mixins:[O,S],data(){return{tableId:"aioseo-post-report-affiliate",linkType:"affiliate",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("Affiliate",this.$tdPro))}}},computed:{columns(){return[{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.affiliate.totals.total,this.$t.__("Affiliate",this.$tdPro))}},methods:{processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},yt={key:0,class:"links-bottom"},Pt={class:"links-bottom-left"},Rt={key:0},At={class:"links-bottom-right"};function It(t,s,n,l,e,i){const k=u("link-assistant-phrase"),c=u("svg-trash"),_=u("core-tooltip"),m=u("core-wp-table"),w=u("svg-link-external"),$=u("link-assistant-confirmation-modal");return r(),g("div",null,[(r(),v(m,{"bulk-options":t.bulkOptions,class:I({"link-assistant-inner-table":!t.postReport}),columns:i.columns,id:e.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,key:t.wpTableKey,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.affiliate.totals,"show-items-per-page":"",onPaginate:i.processPagination,onProcessBulkAction:t.maybeDoBulkAction,onProcessChangeItemsPerPage:t.processChangeItemsPerPage},{phrase:f(({row:d})=>[b(k,{phrase:d.phrase,phraseHtml:d.phrase_html,anchor:d.anchor,url:d.url,clickableAnchor:!0},null,8,["phrase","phraseHtml","anchor","url"])]),delete:f(({index:d})=>[b(_,{type:"action"},{tooltip:f(()=>[R(h(e.strings.deleteLink),1)]),default:f(()=>[b(c,{onClick:y=>t.maybeDoBulkAction({action:"delete",selectedRows:d})},null,8,["onClick"])]),_:2},1024)]),_:1},8,["bulk-options","class","columns","id","initial-items-per-page","initial-page-number","loading","rows","show-pagination","show-table-footer","totals","onPaginate","onProcessBulkAction","onProcessChangeItemsPerPage"])),t.postReport?p("",!0):(r(),g("div",yt,[o("div",Pt,[t.post.links.affiliate.totals.total>5&&t.postReport?(r(),g("div",Rt,[b(w),o("a",{class:"link-view",href:"#",onClick:s[0]||(s[0]=P(d=>t.openPostReport("affiliate"),["prevent"]))},h(i.seeAllLinks),1)])):p("",!0)]),o("div",At,[t.post.links.affiliate.rows.length?(r(),g("a",{key:0,class:"link-delete",onClick:s[1]||(s[1]=P(d=>t.maybeDoBulkAction({action:"delete",selectedRows:"all"}),["prevent"]))},h(e.strings.deleteAllLinks),1)):p("",!0)])])),t.showModal?(r(),v($,{key:1,selectedRows:t.selectedRows,strings:t.modalStrings,onDoBulkAction:t.doBulkAction,onCloseModal:s[2]||(s[2]=d=>t.showModal=!1)},null,8,["selectedRows","strings","onDoBulkAction"])):p("",!0)])}const ze=T(vt,[["render",It]]),Tt={components:{CoreTooltip:B,CoreWpTable:L,LinkAssistantConfirmationModal:M,LinkAssistantPhrase:H,SvgLinkExternal:C,SvgTrash:E},mixins:[O,S],data(){return{tableId:"aioseo-post-report-external",linkType:"external",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("External",this.$tdPro))}}},computed:{columns(){return[{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.external.totals.total,this.$t.__("External",this.$tdPro))}},methods:{processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},St={key:0,class:"links-bottom"},Lt={class:"links-bottom-left"},Ct={key:0},Mt={class:"links-bottom-right"};function Bt(t,s,n,l,e,i){const k=u("link-assistant-phrase"),c=u("svg-trash"),_=u("core-tooltip"),m=u("core-wp-table"),w=u("svg-link-external"),$=u("link-assistant-confirmation-modal");return r(),g("div",null,[(r(),v(m,{"bulk-options":t.bulkOptions,class:I({"link-assistant-inner-table":!t.postReport}),columns:i.columns,id:e.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,key:t.wpTableKey,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.external.totals,"show-items-per-page":"",onPaginate:i.processPagination,onProcessBulkAction:t.maybeDoBulkAction,onProcessChangeItemsPerPage:t.processChangeItemsPerPage},{phrase:f(({row:d})=>[b(k,{phrase:d.phrase,phraseHtml:d.phrase_html,anchor:d.anchor,url:d.url,clickableAnchor:!0},null,8,["phrase","phraseHtml","anchor","url"])]),delete:f(({index:d})=>[b(_,{type:"action"},{tooltip:f(()=>[R(h(e.strings.deleteLink),1)]),default:f(()=>[b(c,{onClick:y=>t.maybeDoBulkAction({action:"delete",selectedRows:d})},null,8,["onClick"])]),_:2},1024)]),_:1},8,["bulk-options","class","columns","id","initial-items-per-page","initial-page-number","loading","rows","show-pagination","show-table-footer","totals","onPaginate","onProcessBulkAction","onProcessChangeItemsPerPage"])),t.postReport?p("",!0):(r(),g("div",St,[o("div",Lt,[t.post.links.external.totals.total>5&&t.linksReport?(r(),g("div",Ct,[b(w),o("a",{class:"link-view",href:"#",onClick:s[0]||(s[0]=P(d=>t.openPostReport("external"),["prevent"]))},h(i.seeAllLinks),1)])):p("",!0)]),o("div",Mt,[t.post.links.external.rows.length?(r(),g("a",{key:0,class:"link-delete",onClick:s[1]||(s[1]=P(d=>t.maybeDoBulkAction({action:"delete",selectedRows:"all"}),["prevent"]))},h(e.strings.deleteAllLinks),1)):p("",!0)])])),t.showModal?(r(),v($,{key:1,selectedRows:t.selectedRows,strings:t.modalStrings,onDoBulkAction:t.doBulkAction,onCloseModal:s[2]||(s[2]=d=>t.showModal=!1)},null,8,["selectedRows","strings","onDoBulkAction"])):p("",!0)])}const Ge=T(Tt,[["render",Bt]]),Et={emits:["openSuggestions"],components:{CoreTooltip:B,CoreWpTable:L,LinkAssistantConfirmationModal:M,LinkAssistantPhrase:H,SvgLinkExternal:C,SvgLinkSuggestion:V,SvgTrash:E},mixins:[O,x,S],data(){return{tableId:"aioseo-post-report-inbound-internal",linkType:"inboundInternal",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("Inbound Internal",this.$td)),outboundSuggestions:this.$t.sprintf(this.$t.__("%1$s Link Suggestions",this.$td),this.$t.__("Inbound",this.$td))}}},computed:{columns(){return[{slug:"post_title",label:this.$t.__("Post Title",this.$td)},{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.inboundInternal.totals.total,this.$t.__("Inbound Internal",this.$td))}},methods:{maybeViewPost(t){var s,n;this.viewPost(((n=(s=t.context)==null?void 0:s.postType)==null?void 0:n.singular)||"Post")},maybeEditPost(t){var s,n;this.editPost(((n=(s=t.context)==null?void 0:s.postType)==null?void 0:n.singular)||"Post")},processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},Dt={key:0},Ot={key:0,class:"row-actions"},Ht={class:"view"},xt=["href"],qt={class:"edit"},Nt=["href"],Ut={key:0,class:"links-bottom"},Yt={class:"links-bottom-left"},Ft={key:1},Kt={class:"links-bottom-right"};function Vt(t,s,n,l,e,i){const k=u("link-assistant-phrase"),c=u("svg-trash"),_=u("core-tooltip"),m=u("core-wp-table"),w=u("svg-link-suggestion"),$=u("base-button"),d=u("svg-link-external"),y=u("link-assistant-confirmation-modal");return r(),g("div",null,[(r(),v(m,{"bulk-options":t.bulkOptions,class:I({"link-assistant-inner-table":!t.postReport}),columns:i.columns,id:e.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,key:t.wpTableKey,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.inboundInternal.totals,"show-items-per-page":"",onPaginate:i.processPagination,onProcessBulkAction:t.maybeDoBulkAction,onProcessChangeItemsPerPage:t.processChangeItemsPerPage},{post_title:f(({row:a})=>[o("span",null,[R(h(a.context.postTitle)+" ",1),a.context.permalink.replace(/\/$/,"")===t.$aioseo.urls.home?(r(),g("span",Dt,"("+h(e.strings.frontPage)+")",1)):p("",!0)]),a.context?(r(),g("div",Ot,[o("span",Ht,[o("a",{href:a.context.permalink,target:"_blank"},h(i.maybeViewPost(a)),9,xt),R(" | ")]),o("span",qt,[o("a",{href:a.context.editLink,target:"_blank"},h(i.maybeEditPost(a)),9,Nt)])])):p("",!0)]),phrase:f(({row:a})=>[b(k,{phrase:a.phrase,phraseHtml:a.phrase_html||"",anchor:a.anchor,url:a.url,clickableAnchor:!0},null,8,["phrase","phraseHtml","anchor","url"])]),delete:f(({index:a})=>[b(_,{type:"action"},{tooltip:f(()=>[R(h(e.strings.deleteLink),1)]),default:f(()=>[b(c,{onClick:X=>t.maybeDoBulkAction({action:"delete",selectedRows:a})},null,8,["onClick"])]),_:2},1024)]),_:1},8,["bulk-options","class","columns","id","initial-items-per-page","initial-page-number","loading","rows","show-pagination","show-table-footer","totals","onPaginate","onProcessBulkAction","onProcessChangeItemsPerPage"])),t.postReport?p("",!0):(r(),g("div",Ut,[o("div",Yt,[t.post.links.inboundInternal.rows.length?(r(),v($,{key:0,type:"blue",tag:"button",onClick:s[0]||(s[0]=a=>t.$emit("openSuggestions"))},{default:f(()=>[b(w),R(" "+h(e.strings.outboundSuggestions),1)]),_:1})):p("",!0),t.post.links.inboundInternal.totals.total>5&&t.linksReport?(r(),g("div",Ft,[b(d),o("a",{class:"link-view",href:"#",onClick:s[1]||(s[1]=P(a=>t.openPostReport("inbound-internal"),["prevent"]))},h(i.seeAllLinks),1)])):p("",!0)]),o("div",Kt,[t.post.links.inboundInternal.rows.length?(r(),g("a",{key:0,class:"link-delete",onClick:s[2]||(s[2]=P(a=>t.maybeDoBulkAction({action:"delete",selectedRows:"all"}),["prevent"]))},h(e.strings.deleteAllLinks),1)):p("",!0)])])),t.showModal?(r(),v(y,{key:1,selectedRows:t.selectedRows,strings:t.modalStrings,onDoBulkAction:t.doBulkAction,onCloseModal:s[3]||(s[3]=a=>t.showModal=!1)},null,8,["selectedRows","strings","onDoBulkAction"])):p("",!0)])}const Ze=T(Et,[["render",Vt]]),Wt={emits:["openSuggestions"],components:{CoreTooltip:B,CoreWpTable:L,LinkAssistantConfirmationModal:M,LinkAssistantPhrase:H,SvgLinkExternal:C,SvgLinkSuggestion:V,SvgTrash:E},mixins:[O,x,S],data(){return{tableId:"aioseo-post-report-outbound-internal",linkType:"outboundInternal",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("Outbound Internal",this.$tdPro)),outboundSuggestions:this.$t.sprintf(this.$t.__("%1$s Link Suggestions",this.$td),this.$t.__("Outbound",this.$tdPro)),openUrl:this.$t.__("Open URL",this.$tdPro)}}},computed:{columns(){return[{slug:"post_title",label:this.$t.__("Post Title / URL",this.$tdPro)},{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.outboundInternal.totals.total,this.$t.__("Outbound Internal",this.$tdPro))}},methods:{processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},zt={key:0},Gt={key:0},Zt={key:1},Jt={key:0},Qt={key:2,class:"row-actions"},Xt={class:"view"},jt=["href"],ts={class:"edit"},ss=["href"],es={key:3,class:"row-actions"},ns={class:"view"},is=["href"],os={key:0,class:"links-bottom"},rs={class:"links-bottom-left"},ls={key:1},as={class:"links-bottom-right"};function us(t,s,n,l,e,i){const k=u("link-assistant-phrase"),c=u("svg-trash"),_=u("core-tooltip"),m=u("core-wp-table"),w=u("svg-link-suggestion"),$=u("base-button"),d=u("svg-link-external"),y=u("link-assistant-confirmation-modal");return r(),g("div",null,[(r(),v(m,{"bulk-options":t.bulkOptions,class:I({"link-assistant-inner-table":!t.postReport}),columns:i.columns,id:e.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,key:t.wpTableKey,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.outboundInternal.totals,"show-items-per-page":"",onPaginate:i.processPagination,onProcessBulkAction:t.maybeDoBulkAction,onProcessChangeItemsPerPage:t.processChangeItemsPerPage},{post_title:f(({row:a})=>[a.context&&a.context.postTitle?(r(),g("span",zt,[R(h(a.context.postTitle)+" ",1),a.url.replace(/\/$/,"")===t.$aioseo.urls.home?(r(),g("span",Gt,"("+h(e.strings.frontPage)+")",1)):p("",!0)])):p("",!0),!a.context||!a.context.postTitle?(r(),g("span",Zt,[R(h(a.url)+" ",1),a.url.replace(/\/$/,"")===t.$aioseo.urls.home?(r(),g("span",Jt,"("+h(e.strings.frontPage)+")",1)):p("",!0)])):p("",!0),a.context?(r(),g("div",Qt,[o("span",Xt,[o("a",{href:a.url,target:"_blank"},h(t.viewPost(a.context.postType.singular)),9,jt),R(" | ")]),o("span",ts,[o("a",{href:a.context.editLink,target:"_blank"},h(t.editPost(a.context.postType.singular)),9,ss)])])):p("",!0),a.context?p("",!0):(r(),g("div",es,[o("span",ns,[o("a",{href:a.url,target:"_blank"},h(e.strings.openUrl),9,is)])]))]),phrase:f(({row:a})=>[b(k,{phrase:a.phrase,phraseHtml:a.phrase_html,anchor:a.anchor,url:a.url,clickableAnchor:!0},null,8,["phrase","phraseHtml","anchor","url"])]),delete:f(({index:a})=>[b(_,{type:"action"},{tooltip:f(()=>[R(h(e.strings.deleteLink),1)]),default:f(()=>[b(c,{onClick:X=>t.maybeDoBulkAction({action:"delete",selectedRows:a})},null,8,["onClick"])]),_:2},1024)]),_:1},8,["bulk-options","class","columns","id","initial-items-per-page","initial-page-number","loading","rows","show-pagination","show-table-footer","totals","onPaginate","onProcessBulkAction","onProcessChangeItemsPerPage"])),t.postReport?p("",!0):(r(),g("div",os,[o("div",rs,[t.post.links.outboundInternal.rows.length?(r(),v($,{key:0,type:"blue",tag:"button",onClick:s[0]||(s[0]=a=>t.$emit("openSuggestions"))},{default:f(()=>[b(w),R(" "+h(e.strings.outboundSuggestions),1)]),_:1})):p("",!0),t.post.links.outboundInternal.totals.total>5&&t.linksReport?(r(),g("div",ls,[b(d),o("a",{class:"link-view",href:"#",onClick:s[1]||(s[1]=P(a=>t.openPostReport("outbound-internal"),["prevent"]))},h(i.seeAllLinks),1)])):p("",!0)]),o("div",as,[t.post.links.outboundInternal.rows.length?(r(),g("a",{key:0,class:"link-delete",onClick:s[2]||(s[2]=P(a=>t.maybeDoBulkAction({action:"delete",selectedRows:"all"}),["prevent"]))},h(e.strings.deleteAllLinks),1)):p("",!0)])])),t.showModal?(r(),v(y,{key:1,selectedRows:t.selectedRows,strings:t.modalStrings,onDoBulkAction:t.doBulkAction,onCloseModal:s[3]||(s[3]=a=>t.showModal=!1)},null,8,["selectedRows","strings","onDoBulkAction"])):p("",!0)])}const Je=T(Wt,[["render",us]]),J={emits:["updatingLinks","linksUpdated"],mixins:[Z],props:{post:{type:Object,required:!0},postIndex:{type:Number,required:!1},postId:{type:Number,required:!1},filteredSuggestionsOutbound:{type:Array,required:!1},postReport:{type:Boolean,default(){return!1}},linksReport:{type:Boolean,default(){return!1}},metabox:{type:Boolean,default(){return!1}}},beforeMount(){this.$bus.$on("updatingLinks",t=>{this.wpTableLoading=t}),this.pageNumber=this.suggestionType?this.linkAssistant.postReport[this.suggestionType].totals.page:1},data(){return{changeItemsPerPageSlug:"linkAssistantPostsReport",editablePhraseKey:0,activeSuggestionRow:-1,action:"",showModal:!1,selectedRows:[],bulkOptions:[{label:this.$t.__("Add Link",this.$tdPro),value:"add"},{label:this.$t.__("Description",this.$td),value:"dismiss"}],strings:{addLink:this.$t.__("Add Link",this.$tdPro),dismiss:this.$t.__("Dismiss Suggestion",this.$tdPro)}}},computed:{...D(["linkAssistant","currentPost"]),rows(){if(!this.metabox)return this.post.links[this.suggestionType].rows;const t=this.pageNumber===1?0:(this.pageNumber-1)*10;return this.suggestionType==="suggestionsOutbound"?this.filteredSuggestionsOutbound.slice(t,t+10):this.post.links[this.suggestionType].rows.slice(t,t+10)},modalStrings(){return this.action==="add"?{areYouSureSingle:this.$t.__("Are you sure you want to add this suggestion?",this.$tdPro),areYouSureMultiple:this.$t.__("Are you sure you want to add these suggestions?",this.$tdPro),areYouSureAll:this.$t.__("Are you sure you want to add all suggestions?",this.$tdPro),actionCannotBeUndone:this.$t.__("This action cannot be undone.",this.$tdPro),yesSingle:this.$t.__("Yes, I want to add this suggestion",this.$tdPro),yesMultiple:this.$t.__("Yes, I want to add these suggestions",this.$tdPro),yesAll:this.$t.__("Yes, I want to add all suggestions",this.$tdPro),noChangedMind:this.$t.__("No, I changed my mind",this.$tdPro)}:{areYouSureSingle:this.$t.__("Are you sure you want to dismiss this suggestion?",this.$tdPro),areYouSureMultiple:this.$t.__("Are you sure you want to dismiss these suggestions?",this.$tdPro),areYouSureAll:this.$t.__("Are you sure you want to dismiss all suggestions?",this.$tdPro),actionCannotBeUndone:this.$t.__("This action cannot be undone.",this.$tdPro),yesSingle:this.$t.__("Yes, I want to dismiss this suggestion",this.$tdPro),yesMultiple:this.$t.__("Yes, I want to dismiss these suggestions",this.$tdPro),yesAll:this.$t.__("Yes, I want to dismiss all suggestions",this.$tdPro),noChangedMind:this.$t.__("No, I changed my mind",this.$tdPro)}}},methods:{...U("linkAssistant",["suggestionDismiss","suggestionsBulk","fetchPostReport","fetchLinksReportInner","postSettingsUpdate"]),fetchData(t){this.$bus.$emit("updatingLinks",!0);const s={...t,additionalFilters:{postId:this.post.ID||this.currentPost.id,postIndex:this.postIndex,type:this.suggestionType}},n=this.postReport?"fetchPostReport":"fetchLinksReportInner";return this[n](s).finally(()=>{this.$bus.$emit("updatingLinks",!1)})},toggleShowMorePhrases(t){if(this.activeSuggestionRow===t){this.activeSuggestionRow=-1;return}this.activeSuggestionRow=t},toggleShowMorePostTitles(t){if(this.activeSuggestionRow===t){this.activeSuggestionRow=-1;return}this.activeSuggestionRow=t},openPostReport(t,s){window.location.href=`#/post-report?postId=${this.postId}&postIndex=${this.postIndex}&initialTab=${t}&initialSuggestionTab=${s}`},saveModifiedPhrase(t){let s=null;this.linksReport&&(s=this.linkAssistant.linksReport.rows[this.postIndex].links[this.suggestionType].rows[t.postIndex]),this.postReport&&(s=this.linkAssistant.postReport[this.suggestionType].rows[t.postIndex]),this.metabox&&(s=this.currentPost.linkAssistant.links[this.suggestionType].rows[t.postIndex]),s.suggestions[t.phraseIndex].phrase_html!==t.phraseHtml&&(s.suggestions[t.phraseIndex].phrase=t.phrase,s.suggestions[t.phraseIndex].phrase_html=t.phraseHtml,s.suggestions[t.phraseIndex].anchor=t.anchor)},addLink(t,s){let n=null;if(this.suggestionType==="suggestionsInbound"){const e=`editablePhrase${s}`;n=this.$refs[e].selectedPhrase}if(this.suggestionType==="suggestionsOutbound"&&(n=this.selectedPostTitleIndex),n===!1||typeof n>"u"){console.error("Couldn't determine index of suggestion.");return}if(this.suggestionType==="suggestionsOutbound"){const e=A(t.suggestions[0].context.permalink),i=A(t.suggestions[n].context.permalink),k=new RegExp(`/${e}/`,"i"),c=t.suggestions[0].phrase_html.replace(k,i);t.suggestions[n].phrase_html=c,t.suggestions[n].anchor=t.suggestions[0].anchor}const l=t.suggestions[n];t.suggestions[n]=t.suggestions[0],t.suggestions[0]=l,this.maybeDoBulkAction({action:"add",selectedRows:t})},maybeDoBulkAction({action:t,selectedRows:s}){s===!1||s===void 0||!t||(this.action=t,this.selectedRows=s,this.showModal=!0)},doBulkAction(){if(this.showModal=!1,!this.selectedRows)return;if(this.action==="dismiss"&&typeof this.selectedRows=="number"){this.doDismissSuggestion(this.selectedRows);return}if(this.selectedRows==="all"){this.$bus.$emit("updatingLinks",!0),this.suggestionsBulk({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,action:this.action,suggestionType:this.suggestionType,suggestionRows:"all",linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated"),this.refreshTable()});return}let t=null;if(this.linksReport&&(t=this.linkAssistant.linksReport.rows[this.postIndex].links[this.suggestionType].rows),this.postReport&&(t=this.linkAssistant.postReport[this.suggestionType].rows),this.metabox){if(this.action==="add"&&this.suggestionType!=="suggestionsInbound"){if(this.$bus.$emit("updatingLinks",!0),Array.isArray(this.selectedRows))this.selectedRows.forEach(n=>{this.editorAddSuggestion(n)});else{const n=this.selectedRows;this.editorAddSuggestion(n)}this.$bus.$emit("updatingLinks",!1);return}t=this.currentPost.linkAssistant.links[this.suggestionType].rows}const s=[];Array.isArray(this.selectedRows)?this.selectedRows.forEach(n=>{s.push(t[n])}):s.push(this.selectedRows),this.$bus.$emit("updatingLinks",!0),this.suggestionsBulk({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,action:this.action,suggestionType:this.suggestionType,suggestionRows:s,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated"),this.refreshTable()})},doDismissSuggestion(t){this.$bus.$emit("updatingLinks",!0),this.suggestionDismiss({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,suggestionId:t,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated"),this.refreshTable()})},editorAddSuggestion(t){q()&&this.blockEditorAddSuggestion(t),N()&&this.classicEditorAddSuggestion(t)},blockEditorAddSuggestion(t){let s=null,n=null;if(isNaN(t)?this.rows.forEach(($,d)=>{$.suggestions[0].id===t.suggestions[0].id&&(s=$,n=d)}):(n=t,s=this.rows[t]),!s||n===!1)return;this.$bus.$emit("updatingLinks",!0);const l=window.wp.data.select("core/block-editor").getBlocks(),e=s.suggestions[0].original_phrase_html.trim(),i=this.findTargetBlock(l,e);if(!i){this.$bus.$emit("updatingLinks",!1);return}const k=window.wp.data.select("core/block-editor").getBlock(i);if(!k){this.$bus.$emit("updatingLinks",!1);return}const c=A(s.suggestions[0].anchor.trim());let _=new RegExp(`(${c})`,"i");const m=s.suggestions[0].phrase_html.trim(),w=A(e);_=new RegExp(`(${w})`,"i"),window.wp.data.dispatch("core/block-editor").updateBlockAttributes(i,{content:k.attributes.content.replace(_,m)}).then(()=>{this.rows.splice(n,1)}).catch($=>{console.error("Couldn't add outbound link:",$)}).finally(()=>{this.postSettingsUpdate({postContent:window.wp.data.select("core/editor").getEditedPostContent(),skipNextRun:!0})})},classicEditorAddSuggestion(t){let s=null,n=null;if(isNaN(t)?this.rows.forEach(($,d)=>{$.suggestions[0].id===t.suggestions[0].id&&(s=$,n=d)}):(n=t,s=this.rows[t]),!s||n===!1)return;this.$bus.$emit("updatingLinks",!0);let l="",e=null,i=null;if(document.querySelector("#wp-content-wrap.tmce-active")?(e=window.tinyMCE.get("content"),l=e.getContent({format:"raw"})):(i=document.querySelector("textarea#content"),l=i?i.value:""),!l){this.$bus.$emit("updatingLinks",!1);return}const k=s.suggestions[0].original_phrase_html.trim(),c=A(k),_=A(s.suggestions[0].anchor.trim());let m=new RegExp(`(${_})`,"i");const w=s.suggestions[0].phrase_html.trim();m=new RegExp(`(${c})`,"i"),l=l.replace(m,w),e?e.setContent(l):i.value=l,this.rows.splice(n,1),this.postSettingsUpdate({postContent:l,skipNextRun:!0}).finally(()=>{this.$bus.$emit("updatingLinks",!1)})}}};const ds={emits:["saveEditor","closeEditor"],components:{BaseEditor:ut},props:{phrase:{type:String,required:!0},url:{type:String,required:!0},context:{type:String,required:!1}},data(){return{strings:{saveChanges:this.$t.__("Save Changes",this.$tdPro),cancel:this.$t.__("Cancel",this.$tdPro),context:this.$t.__("Context",this.$tdPro)}}},mounted(){this.$refs.linkEditor.setPhrase(this.phrase);const t=document.querySelector(".ql-autoLink");t&&(t.innerHTML='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"></line><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"></path><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"></path></svg>',t.classList.add("ql-disabled"))},methods:{getPhrase(){return this.$refs.linkEditor.getPhrase()},getPhraseHtml(){return this.$refs.linkEditor.getPhraseHtml()},getPhraseWithFormats(){return this.$refs.linkEditor.getPhraseWithFormats()},selectionChange({range:t,source:s}){const n=document.querySelector(".ql-autoLink");n&&(!t||!t.length||s!=="user")?n.classList.add("ql-disabled"):n.classList.remove("ql-disabled")}}},hs={class:"aioseo-phrase-editor"},ps={key:0,class:"context"},gs={class:"context-label"},cs=["innerHTML"],ks={class:"action-buttons"};function ms(t,s,n,l,e,i){const k=u("base-editor"),c=u("base-button");return r(),g("div",hs,[n.context?(r(),g("div",ps,[o("p",null,[o("strong",gs,h(e.strings.context)+":",1)]),o("p",{innerHTML:n.context},null,8,cs)])):p("",!0),b(k,{ref:"linkEditor","auto-link":{url:n.url,phrase:n.phrase},"show-toolbar":"","allow-tags":"","onUpdate:modelValue":s[0]||(s[0]=_=>t.$emit("update:modelValue",_)),onSelectionChange:i.selectionChange},null,8,["auto-link","onSelectionChange"]),o("div",ks,[b(c,{type:"blue",size:"small",onClick:s[1]||(s[1]=_=>t.$emit("saveEditor"))},{default:f(()=>[R(h(e.strings.saveChanges),1)]),_:1}),b(c,{type:"gray",size:"small",onClick:s[2]||(s[2]=_=>t.$emit("closeEditor"))},{default:f(()=>[R(h(e.strings.cancel),1)]),_:1})])])}const fs=T(ds,[["render",ms]]);const bs={emits:["toggleShowMorePhrases","saveModifiedPhrase","delete"],components:{LinkAssistantPhrase:H,LinkAssistantPhraseEditor:fs,SvgCaret:W,SvgPencil:at,SvgTrash:E,TransitionSlide:z},props:{row:{type:Object,required:!0},rowIndex:{type:Number,default:0},activeRow:{type:Number,default:-1},postIndex:{type:Number,required:!1},suggestionType:{type:String,required:!1},selectedPostTitleIndex:{type:Number,required:!1,default(){return 0}},linkSuggestion:{type:Boolean,default(){return!1}},domainsReport:{type:Boolean,default(){return!1}}},data(){return{phraseIndex:-1,showEditor:-1,hoveringOver:-1,selectedPhrase:0}},computed:{...D(["linkAssistant","currentPost"]),phrases(){return this.linkSuggestion?this.row.suggestions.slice(0,10):this.row.links.slice(0,10)},url(){return this.domainsReport?this.phrases[this.phraseIndex].url:this.suggestionType==="suggestionsInbound"?this.row.context.permalink:this.suggestionType==="suggestionsOutbound"?this.row.suggestions[this.selectedPostTitleIndex].context.permalink:""},showingMorePhrases(){return 1<this.phrases.length&&this.activeRow===this.rowIndex},viewMorePhrasesLabel(){const t=1<this.phrases.length?this.phrases.length-1:0;return this.$t.sprintf(this.$t._n("%1$d more phrase","%1$d more phrases",t,this.$td),t)},phraseContext(){let t="",s="";if(this.linkSuggestion){const e=this.row.suggestions[this.phraseIndex];t=e.phrase.trim(),s=e.paragraph.trim()}else{const e=this.row.links[this.phraseIndex];t=e.phrase.trim(),s=e.paragraph.trim()}if(t===s)return"";const n=A(t),l=new RegExp(n,"i");return s.match(l)&&(s=s.replace(l,`<strong>${t}</strong>`)),s}},methods:{tooltipUrl(t,s){return this.domainsReport?s.url:this.suggestionType==="suggestionsInbound"?t.permalink:this.suggestionType==="suggestionsOutbound"&&t.suggestions[this.selectedPostTitleIndex]?t.suggestions[this.selectedPostTitleIndex].context.permalink:""},openEditor(t,s){this.phraseIndex=s,this.showEditor=t},processModifiedPhrase(){this.showEditor=-1,this.hoveringOver=-1;const t=this.$refs.linkEditor.getPhrase(),s=this.$refs.linkEditor.getPhraseHtml(),n=this.$refs.linkEditor.getPhraseWithFormats();let l="";n.ops.forEach(e=>{e.attributes&&e.attributes.link&&(l=l+e.insert)}),l&&this.$emit("saveModifiedPhrase",{phrase:t,phraseHtml:s,anchor:l,postIndex:this.rowIndex,phraseIndex:this.phraseIndex})},deleteLink(t,s,n){t.stopPropagation(),t.preventDefault(),this.$emit("delete",{postIndex:s,linkIndex:n})}}},_s={class:"aioseo-editable-phrase"},$s={class:"domains-report-editable-phrase"},ws={key:0},vs=["checked"],ys={class:"icons"},Ps={key:0,class:"show-more-phrases"},Rs=["onClick"],As=["checked","onClick"],Is={class:"icons"};function Ts(t,s,n,l,e,i){const k=u("svg-pencil"),c=u("svg-trash"),_=u("link-assistant-phrase"),m=u("svg-caret"),w=u("transition-slide"),$=u("link-assistant-phrase-editor");return r(),g("div",_s,[o("div",$s,[e.showEditor!==n.rowIndex?(r(),g("div",ws,[o("div",{class:"editable-phrase first-phrase",onClick:s[4]||(s[4]=d=>i.openEditor(n.rowIndex,0))},[n.linkSuggestion&&i.showingMorePhrases&&n.suggestionType!=="suggestionsOutbound"?(r(),g("input",{key:0,type:"radio",checked:e.selectedPhrase===0,onClick:s[0]||(s[0]=P(d=>e.selectedPhrase=0,["stop"]))},null,8,vs)):p("",!0),b(_,{url:i.tooltipUrl(n.row,i.phrases[0]),phrase:i.phrases[0].phrase,phraseHtml:i.phrases[0].phrase_html,anchor:i.phrases[0].anchor,class:I({hover:e.hoveringOver===0}),onMouseOver:s[2]||(s[2]=d=>e.hoveringOver=0),onMouseLeave:s[3]||(s[3]=d=>e.hoveringOver=-1)},{icons:f(()=>[o("span",ys,[b(k),n.domainsReport?(r(),v(c,{key:0,onClick:s[1]||(s[1]=d=>i.deleteLink(d,n.rowIndex,0))})):p("",!0)])]),_:1},8,["url","phrase","phraseHtml","anchor","class"])]),n.suggestionType!=="suggestionsOutbound"&&1<i.phrases.length&&e.showEditor!==n.rowIndex?(r(),g("div",Ps,[o("a",{href:"#",onClick:s[5]||(s[5]=P(d=>{t.$emit("toggleShowMorePhrases",n.rowIndex),e.selectedPhrase=0},["prevent"]))},[o("div",null,h(i.viewMorePhrasesLabel),1),b(m,{class:I({rotated:i.showingMorePhrases})},null,8,["class"])])])):p("",!0),b(w,{class:"phrases-list",tag:"div",active:i.showingMorePhrases&&n.suggestionType!=="suggestionsOutbound"},{default:f(()=>[(r(!0),g(F,null,K(i.phrases,(d,y)=>(r(),g("div",{class:"editable-phrase-container",key:y},[y?(r(),g("div",{key:0,class:"editable-phrase selectable-phrase",onClick:a=>i.openEditor(n.rowIndex,y)},[n.linkSuggestion&&i.showingMorePhrases?(r(),g("input",{key:0,type:"radio",checked:y===e.selectedPhrase,onClick:P(a=>e.selectedPhrase=y,["stop"])},null,8,As)):p("",!0),b(_,{url:i.tooltipUrl(n.row,i.phrases[0]),phrase:d.phrase,phraseHtml:d.phrase_html,anchor:d.anchor,class:I({hover:y===e.hoveringOver}),onMouseOver:a=>e.hoveringOver=y,onMouseLeave:s[6]||(s[6]=a=>e.hoveringOver=-1)},{icons:f(()=>[o("div",Is,[b(k),n.domainsReport?(r(),v(c,{key:0,onClick:a=>i.deleteLink(a,n.rowIndex,y)},null,8,["onClick"])):p("",!0)])]),_:2},1032,["url","phrase","phraseHtml","anchor","class","onMouseOver"])],8,Rs)):p("",!0)]))),128))]),_:1},8,["active"])])):p("",!0),e.showEditor===n.rowIndex?(r(),v($,{key:1,ref:"linkEditor",modelValue:i.phrases[this.phraseIndex].phrase,phrase:i.phrases[this.phraseIndex].phrase_html,url:i.url,context:i.phraseContext,onSaveEditor:i.processModifiedPhrase,onCloseEditor:s[7]||(s[7]=d=>{e.showEditor=-1,e.hoveringOver=-1})},null,8,["modelValue","phrase","url","context","onSaveEditor"])):p("",!0)])])}const Q=T(bs,[["render",Ts]]),Ss={components:{CoreWpTable:L,LinkAssistantConfirmationModal:M,LinkAssistantEditablePhrase:Q,SvgCirclePlus:G,SvgLinkExternal:C},mixins:[x,J,S],data(){return{tableId:"aioseo-post-report-inbound-suggestions",suggestionType:"suggestionsInbound",strings:{dismissAllSuggestions:this.$t.sprintf(this.$t.__("Dismiss All %1$s Suggestions",this.$tdPro),this.$t.__("Inbound Internal",this.$tdPro)),noSuggestions:this.$t.sprintf(this.$t.__("You currently don't have any %1$s Suggestions!",this.$tdPro),this.$t.__("Inbound Internal",this.$tdPro))}}},computed:{columns(){return[{slug:"post_title",label:this.$t.__("Post Title",this.$td)},{slug:"spacer",width:"30px"},{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"add_link",width:"150px"}]},seeAllSuggestions(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Suggestions",this.$tdPro),this.post.links.suggestionsInbound.totals.total,this.$t.__("Inbound Internal",this.$tdPro))}},methods:{processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},Ls={class:"aioseo-link-suggestions-Inbound"},Cs=["href"],Ms={class:"row-actions"},Bs={class:"view"},Es=["href"],Ds={class:"edit"},Os=["href"],Hs={class:"dismiss"},xs=["onClick"],qs=["onClick"],Ns={key:0,class:"links-bottom"},Us={class:"links-bottom-left"},Ys={key:0},Fs={class:"links-bottom-right"};function Ks(t,s,n,l,e,i){const k=u("link-assistant-editable-phrase"),c=u("svg-circle-plus"),_=u("core-wp-table"),m=u("svg-link-external"),w=u("link-assistant-confirmation-modal");return r(),g("div",Ls,[(r(),v(_,{"bulk-options":t.bulkOptions,class:I({"link-assistant-inner-table":!t.postReport}),columns:i.columns,id:e.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,key:t.wpTableKey,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.suggestionsInbound.totals,"show-items-per-page":"",onPaginate:i.processPagination,onProcessBulkAction:t.maybeDoBulkAction,onProcessChangeItemsPerPage:t.processChangeItemsPerPage},{post_title:f(({row:$})=>[o("strong",null,[o("a",{class:"edit-link",href:$.context.permalink,target:"_blank"},h($.context.postTitle),9,Cs)]),o("div",Ms,[o("span",Bs,[o("a",{href:$.context.permalink,target:"_blank"},h(t.viewPost($.context.postType.singular)),9,Es),R(" | ")]),o("span",Ds,[o("a",{href:$.context.editLink,target:"_blank"},h(t.editPost($.context.postType.singular)),9,Os),R(" | ")]),o("span",Hs,[o("a",{href:"#",onClick:P(d=>t.maybeDoBulkAction({action:"dismiss",selectedRows:$}),["prevent"])},h(e.strings.dismiss),9,xs)])])]),phrase:f(({row:$,index:d})=>[b(k,{ref:"editablePhrase"+d,row:$,rowIndex:d,activeRow:t.activeSuggestionRow,postIndex:t.postIndex,suggestionType:e.suggestionType,linkSuggestion:"",onHidePhrases:s[0]||(s[0]=y=>{t.activeSuggestionRow=-1}),onToggleShowMorePhrases:t.toggleShowMorePhrases,onSaveModifiedPhrase:t.saveModifiedPhrase},null,8,["row","rowIndex","activeRow","postIndex","suggestionType","onToggleShowMorePhrases","onSaveModifiedPhrase"])]),add_link:f(({row:$,index:d})=>[o("div",{class:"add-link",onClick:P(y=>t.addLink($,d),["prevent"])},[b(c),o("a",null,h(e.strings.addLink),1)],8,qs)]),_:1},8,["bulk-options","class","columns","id","initial-items-per-page","initial-page-number","loading","rows","show-pagination","show-table-footer","totals","onPaginate","onProcessBulkAction","onProcessChangeItemsPerPage"])),t.postReport?p("",!0):(r(),g("div",Ns,[o("div",Us,[t.post.links.suggestionsInbound.totals.total>5&&t.linksReport?(r(),g("div",Ys,[b(m),o("a",{class:"link-view",href:"#",onClick:s[1]||(s[1]=P($=>t.openPostReport("link-suggestions","suggestions-inbound"),["prevent"]))},h(i.seeAllSuggestions),1)])):p("",!0)]),o("div",Fs,[t.post.links.suggestionsInbound.rows.length?(r(),g("a",{key:0,class:"link-delete",onClick:s[2]||(s[2]=P($=>t.maybeDoBulkAction({action:"dismiss",selectedRows:"all"}),["prevent"]))},h(e.strings.dismissAllSuggestions),1)):p("",!0)])])),t.showModal?(r(),v(w,{key:1,strings:t.modalStrings,selectedRows:t.selectedRows,onCloseModal:s[3]||(s[3]=$=>t.showModal=!1),onDoBulkAction:t.doBulkAction},null,8,["strings","selectedRows","onDoBulkAction"])):p("",!0)])}const Vs=T(Ss,[["render",Ks]]);const Ws={emits:["toggleShowMorePhrases","postTitleIndexChanged"],components:{SvgCaret:W,TransitionSlide:z},mixins:[x],props:{row:{type:Object,required:!0},rowIndex:{type:Number,default:0},activeRow:{type:Number,default:-1},postIndex:{type:Number,required:!1},suggestionType:{type:String,required:!1}},data(){return{selectedPostTitleIndex:-1,hoveringOver:-1}},computed:{...D(["linkAssistant","currentPost"]),postTitles(){const t=[];return this.row.suggestions.forEach(s=>{t.includes[s.context.postTitle]||t.push(s.context.postTitle)}),t.slice(0,10)},showingMorePostTitles(){return 1<this.postTitles.length&&this.activeRow===this.rowIndex},viewMorePostTitlesLabel(){const t=1<this.postTitles.length?this.postTitles.length-1:0;return this.$t.sprintf(this.$t._n("%1$d more post","%1$d more posts",t,this.$td),t)}},methods:{selectDifferentPostTitle(t){this.selectedPostTitleIndex!==t&&(this.selectedPostTitleIndex=t,this.$emit("postTitleIndexChanged",t))}}},zs={class:"aioseo-post-title-selector"},Gs=["checked"],Zs={class:"post-title-text"},Js={class:"view"},Qs=["href"],Xs={class:"edit"},js=["href"],te={key:0,class:"show-more-post-titles"},se=["onMouseover"],ee=["checked","onClick"],ne={class:"post-title-text"},ie={class:"view"},oe=["href"],re={class:"edit"},le=["href"];function ae(t,s,n,l,e,i){const k=u("svg-caret"),c=u("transition-slide");return r(),g("div",zs,[o("div",{class:"post-title first-post-title",onMouseover:s[1]||(s[1]=_=>e.hoveringOver=0),onMouseleave:s[2]||(s[2]=_=>e.hoveringOver=-1)},[i.showingMorePostTitles?(r(),g("input",{key:0,type:"radio",checked:e.selectedPostTitleIndex===0,onClick:s[0]||(s[0]=P(_=>i.selectDifferentPostTitle(0),["stop"]))},null,8,Gs)):p("",!0),o("span",Zs,h(i.postTitles[0]),1),o("div",{class:I(["row-actions",{hover:e.hoveringOver===0}])},[o("span",Js,[o("a",{href:n.row.suggestions[0].context.permalink,target:"_blank"},h(t.viewPost(n.row.suggestions[0].context.postType.singular)),9,Qs),R(" | ")]),o("span",Xs,[o("a",{href:n.row.suggestions[0].context.editLink,target:"_blank"},h(t.editPost(n.row.suggestions[0].context.postType.singular)),9,js)])],2)],32),1<i.postTitles.length?(r(),g("div",te,[o("a",{href:"#",onClick:s[3]||(s[3]=P(_=>{t.$emit("toggleShowMorePhrases",n.rowIndex),i.selectDifferentPostTitle(0)},["prevent"]))},[o("div",null,h(i.viewMorePostTitlesLabel),1),b(k,{class:I({rotated:i.showingMorePostTitles})},null,8,["class"])])])):p("",!0),b(c,{class:"post-titles-list",tag:"div",active:i.showingMorePostTitles},{default:f(()=>[(r(!0),g(F,null,K(i.postTitles,(_,m)=>(r(),g("div",{class:"post-title post-title-container",key:m},[m?(r(),g("div",{key:0,class:"selectable-post-title",onMouseover:w=>e.hoveringOver=m,onMouseleave:s[4]||(s[4]=w=>e.hoveringOver=-1)},[i.showingMorePostTitles?(r(),g("input",{key:0,type:"radio",checked:m===e.selectedPostTitleIndex,onClick:P(w=>i.selectDifferentPostTitle(m),["stop"])},null,8,ee)):p("",!0),o("span",ne,h(i.postTitles[m]),1),o("div",{class:I(["row-actions",{hover:m===e.hoveringOver}])},[o("span",ie,[o("a",{href:n.row.suggestions[m].context.permalink,target:"_blank"},h(t.viewPost(n.row.suggestions[m].context.postType.singular)),9,oe),R(" | ")]),o("span",re,[o("a",{href:n.row.suggestions[m].context.editLink,target:"_blank"},h(t.editPost(n.row.suggestions[m].context.postType.singular)),9,le)])],2)],40,se)):p("",!0)]))),128))]),_:1},8,["active"])])}const ue=T(Ws,[["render",ae]]),de={components:{CoreWpTable:L,LinkAssistantConfirmationModal:M,LinkAssistantEditablePhrase:Q,LinkAssistantPostTitleSelector:ue,SvgCirclePlus:G,SvgLinkExternal:C},mixins:[J,S],data(){return{tableId:"aioseo-post-report-outbound-suggestions",suggestionType:"suggestionsOutbound",selectedPostTitleIndex:0,strings:{dismissAllSuggestions:this.$t.sprintf(this.$t.__("Dismiss All %1$s Suggestions",this.$tdPro),this.$t.__("Outbound Internal",this.$tdPro)),noSuggestions:this.$t.sprintf(this.$t.__("You currently don't have any %1$s Suggestions!",this.$tdPro),this.$t.__("Outbound Internal",this.$tdPro))}}},computed:{columns(){return[{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"spacer",width:"30px"},{slug:"post_title",label:this.$t.__("Post Title",this.$td)},{slug:"add_link",width:"150px"}]},seeAllSuggestions(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Suggestions",this.$tdPro),this.post.links.suggestionsOutbound.totals.total,this.$t.__("Outbound Internal",this.$tdPro))}},methods:{processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},he={class:"aioseo-link-suggestions-outbound"},pe={class:"row-actions"},ge={class:"dismiss"},ce=["onClick"],ke=["onClick"],me={key:0,class:"links-bottom"},fe={class:"links-bottom-left"},be={key:0},_e={class:"links-bottom-right"};function $e(t,s,n,l,e,i){const k=u("link-assistant-post-title-selector"),c=u("link-assistant-editable-phrase"),_=u("svg-circle-plus"),m=u("core-wp-table"),w=u("svg-link-external"),$=u("link-assistant-confirmation-modal");return r(),g("div",he,[(r(),v(m,{"bulk-options":t.bulkOptions,class:I({"link-assistant-inner-table":!t.postReport}),columns:i.columns,id:e.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,key:t.wpTableKey,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.suggestionsOutbound.totals,"show-items-per-page":"",onPaginate:i.processPagination,onProcessBulkAction:t.maybeDoBulkAction,onProcessChangeItemsPerPage:t.processChangeItemsPerPage},{post_title:f(({row:d,index:y})=>[b(k,{ref:"postTitleSelector"+y,row:d,rowIndex:y,activeRow:t.activeSuggestionRow,postIndex:t.postIndex,suggestionType:e.suggestionType,linkSuggestion:"",onHidePhrases:s[0]||(s[0]=a=>{t.activeSuggestionRow=-1}),onToggleShowMorePhrases:t.toggleShowMorePhrases,onSaveModifiedPhrase:t.saveModifiedPhrase,onPostTitleIndexChanged:s[1]||(s[1]=a=>e.selectedPostTitleIndex=a)},null,8,["row","rowIndex","activeRow","postIndex","suggestionType","onToggleShowMorePhrases","onSaveModifiedPhrase"])]),phrase:f(({row:d,index:y})=>[b(c,{row:d,rowIndex:y,activeRow:t.activeSuggestionRow,postIndex:t.postIndex,suggestionType:e.suggestionType,selectedPostTitleIndex:e.selectedPostTitleIndex,linkSuggestion:"",onHidePhrases:s[2]||(s[2]=a=>{t.activeSuggestionRow=-1}),onSaveModifiedPhrase:t.saveModifiedPhrase},null,8,["row","rowIndex","activeRow","postIndex","suggestionType","selectedPostTitleIndex","onSaveModifiedPhrase"]),o("div",pe,[o("span",ge,[o("a",{href:"#",onClick:P(a=>t.maybeDoBulkAction({action:"dismiss",selectedRows:d}),["prevent"])},h(e.strings.dismiss),9,ce)])])]),add_link:f(({row:d,index:y})=>[o("div",{class:"add-link",onClick:P(a=>t.addLink(d,y),["prevent"])},[b(_),o("a",null,h(e.strings.addLink),1)],8,ke)]),_:1},8,["bulk-options","class","columns","id","initial-items-per-page","initial-page-number","loading","rows","show-pagination","show-table-footer","totals","onPaginate","onProcessBulkAction","onProcessChangeItemsPerPage"])),t.postReport?p("",!0):(r(),g("div",me,[o("div",fe,[t.post.links.suggestionsOutbound.totals.total>5&&t.linksReport?(r(),g("div",be,[b(w),o("a",{class:"link-view",href:"#",onClick:s[3]||(s[3]=P(d=>t.openPostReport("link-suggestions","suggestions-outbound"),["prevent"]))},h(i.seeAllSuggestions),1)])):p("",!0)]),o("div",_e,[t.filteredSuggestionsOutbound.length?(r(),g("a",{key:0,class:"link-delete",onClick:s[4]||(s[4]=P(d=>t.maybeDoBulkAction({action:"dismiss",selectedRows:"all"}),["prevent"]))},h(e.strings.dismissAllSuggestions),1)):p("",!0)])])),t.showModal?(r(),v($,{key:1,strings:t.modalStrings,selectedRows:t.selectedRows,onCloseModal:s[5]||(s[5]=d=>t.showModal=!1),onDoBulkAction:t.doBulkAction},null,8,["strings","selectedRows","onDoBulkAction"])):p("",!0)])}const we=T(de,[["render",$e]]);const ve={emits:["linksUpdated","suggestionsTabChanged"],components:{CoreAlert:nt,CoreMainTabs:ot,Inbound:Vs,Outbound:we,SvgLinkInternalInbound:st,SvgLinkInternalOutbound:et},mixins:[O],props:{filteredSuggestionsOutbound:{type:Array,required:!0},initialTab:{type:String,required:!1},showAlert:{type:Boolean,default(){return!1}}},data(){return{tabsKey:0,activeTab:"suggestions-inbound",strings:{description:this.$t.sprintf(this.$t.__("Below you can add inbound and outbound internal links based on %1$s's smart suggestions. These suggestions are generated in the background, which requires some time to complete. %2$s",this.$tdPro),"AIOSEO",this.$links.getDocLink(this.$constants.GLOBAL_STRINGS.learnMore,"linkAssistant",!0))}}},computed:{...D("linkAssistant",["internalOptions"]),...it("linkAssistant",["getLinksReportCounts"]),tabs(){return[{slug:"suggestions-inbound",icon:"svg-link-internal-inbound",name:this.$t.sprintf("%1$s %2$s",this.metabox?this.post.links.suggestionsInbound.totals.total:this.getLinksReportCounts[this.postIndex].suggestionsInbound,this.$t.__("Inbound Internal Suggestions",this.$tdPro))},{slug:"suggestions-outbound",icon:"svg-link-internal-outbound",name:this.$t.sprintf("%1$s %2$s",this.metabox?this.filteredSuggestionsOutbound.length:this.getLinksReportCounts[this.postIndex].suggestionsOutbound,this.$t.__("Outbound Internal Suggestions",this.$tdPro))}]}},methods:{...U("linkAssistant",["setLinksReportCounts"]),processChangeTab(t){this.activeTab=t,this.$emit("suggestionsTabChanged",t)},dismissAlert(){this.internalOptions.internal.dismissedAlerts.suggestions=!0,this.$http.get(this.$links.restUrl("link-assistant/data/dismiss-alert")).catch(t=>console.log("Could not dismiss suggestions alert:",t))}},beforeMount(){this.initialTab&&(this.activeTab=this.initialTab),this.setLinksReportCounts()}},ye={class:"aioseo-link-suggestions"},Pe=["innerHTML"],Re={class:"link-suggestions-container"};function Ae(t,s,n,l,e,i){const k=u("core-alert"),c=u("core-main-tabs"),_=u("outbound"),m=u("inbound");return r(),g("div",ye,[t.internalOptions.internal.dismissedAlerts.suggestions?p("",!0):(r(),v(k,{key:0,class:"description",type:"blue","show-close":"",onCloseAlert:i.dismissAlert},{default:f(()=>[o("span",{innerHTML:e.strings.description},null,8,Pe)]),_:1},8,["onCloseAlert"])),(r(),v(c,{internal:"",key:e.tabsKey,tabs:i.tabs,active:e.activeTab,showSaveButton:!1,onChanged:i.processChangeTab},{"var-tab-icon":f(({tab:w})=>[(r(),v(tt(w.icon),{class:I([{warning:w.warning}])},null,8,["class"]))]),_:1},8,["tabs","active","onChanged"])),o("div",Re,[(r(),v(Y,null,[e.activeTab==="suggestions-outbound"?(r(),v(_,{key:0,post:t.post,postIndex:t.postIndex,postId:t.postId,filteredSuggestionsOutbound:n.filteredSuggestionsOutbound,linksReport:t.linksReport,postReport:t.postReport,metabox:t.metabox,onLinksUpdated:s[0]||(s[0]=w=>{e.tabsKey++,t.$emit("linksUpdated")})},null,8,["post","postIndex","postId","filteredSuggestionsOutbound","linksReport","postReport","metabox"])):p("",!0)],1024)),(r(),v(Y,null,[e.activeTab==="suggestions-inbound"?(r(),v(m,{key:0,post:t.post,postIndex:t.postIndex,postId:t.postId,linksReport:t.linksReport,postReport:t.postReport,metabox:t.metabox,onLinksUpdated:s[1]||(s[1]=w=>{e.tabsKey++,t.$emit("linksUpdated")})},null,8,["post","postIndex","postId","linksReport","postReport","metabox"])):p("",!0)],1024))])])}const Qe=T(ve,[["render",Ae]]);export{ze as L,We as S,Ge as a,Ze as b,Je as c,Qe as d,M as e,Q as f};
