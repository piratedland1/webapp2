import{_ as g,r as m,o as w,c as T,f as d,t as y,d as c,w as h,e as $,a as P,b as k}from"./js/_plugin-vue_export-helper.49ea0e68.js";import{l as A}from"./js/index.9ef60339.js";import{S as E,l as B}from"./js/index.d59f905b.js";import{l as I}from"./js/index.0b123ab1.js";import{e as C}from"./js/elemLoaded.9a6eb745.js";import{s as N}from"./js/postContent.53eb7ed3.js";import{e as q,i as l,g as L,d as O,s as _}from"./js/index.3cfc26e3.js";import{a as D}from"./js/vuex.esm-bundler.ccdd8fb3.js";import{C as V}from"./js/Tooltip.754dc940.js";import{a as F}from"./js/constants.355a3bff.js";import{b as M}from"./js/_baseIteratee.95045ea2.js";import{b as Q}from"./js/_basePickBy.49a97fc0.js";import{s as U,a as G,g as H,b as K}from"./js/_baseIsEqual.29b00359.js";import{k as z}from"./js/isArrayLikeObject.8c985d83.js";import"./js/client.7afeb6b0.js";import"./js/_commonjsHelpers.f84db168.js";import"./js/default-i18n.3a91e0e5.js";import"./js/helpers.871dba46.js";import"./js/Caret.09e548f3.js";import"./js/cleanForSlug.13f04843.js";import"./js/html.68197829.js";import"./js/_baseSet.ee0f5847.js";import"./js/_getTag.fe118f3c.js";var R=Object.getOwnPropertySymbols,J=R?function(e){for(var t=[];e;)G(t,H(e)),e=q(e);return t}:U;const W=J;function X(e){return K(e,z,W)}function Y(e,t){if(e==null)return{};var r=F(X(e),function(o){return[o]});return t=M(t),Q(e,r,function(o,s){return t(o,s[0])})}const x={getTerms:async e=>{const{apiFetch:t}=window.wp,{addQueryArgs:r}=window.wp.url,o=p(e);return await t({path:r(`/wp/v2/${o.restBase}`,{per_page:-1,orderby:"count",order:"desc",_fields:"id,name"})})},getSelectedTerms:e=>{const t=p(e);return window.wp.data.select("core/editor").getEditedPostAttribute(t.restBase)||[]}},v={getTerms:async e=>{const t=[];return document.getElementById(`${e}checklist`).querySelectorAll("li").forEach(o=>{const s=o.querySelector("input").value,n=o.querySelector("label").innerText;t.push({id:parseInt(s,10),name:n.trim()})}),new Promise(o=>{o(t)})},getSelectedTerms:e=>{const t=document.getElementById(`${e}checklist`).querySelectorAll("input:checked"),r=[];return t.forEach(o=>{r.push(parseInt(o.value,10))}),r}},u=()=>{var t;return(((t=window.aioseo.postData)==null?void 0:t.taxonomies)||[]).filter(r=>r.primaryTermSupport===!0)},Z=e=>u().some(t=>e===t.slug),p=e=>{const t=u().filter(r=>e===r.slug);return t.length?t[0]:{}},j=e=>l()?x.getTerms(e):v.getTerms(e),ee=e=>l()?x.getSelectedTerms(e):v.getSelectedTerms(e);const te={components:{CoreTooltip:V,SvgCircleQuestionMark:E},data(){return{term:null,terms:[],selectedTerms:[],strings:{tooltip:this.$t.sprintf(this.$t.__("%1$s allows you to choose a primary category for your posts. This feature works hand in hand with our powerful Breadcrumbs template to give you full navigational control to help improve your search rankings.",this.$tdPro),"AIOSEO Pro")}}},props:{taxonomy:String},watch:{terms(e){if(!this.term&&e&&this.currentPost.primary_term[this.taxonomy]){const t=e.find(r=>r.value===this.currentPost.primary_term[this.taxonomy]);this.setPrimaryTerm(t)}},selectedTerms(e,t){if(t.length<e.length){const r=e.filter(o=>!t.includes(o))[0];this.terms.some(o=>o.value===r)||this.updateTerms()}this.term&&this.term.value&&!e.includes(this.term.value)&&this.setPrimaryTerm(null)}},computed:{...D(["currentPost"]),labelString(){const e=p(this.taxonomy).singular;return this.$t.sprintf(this.$t.__("Select Primary %1$s",this.$td),e)},options(){return this.terms.filter(e=>this.selectedTerms.includes(e.value))}},methods:{setPrimaryTerm(e){this.term=e,this.$bus.$emit("standalone-update-post",{primary_term:Y({...this.currentPost.primary_term,[this.taxonomy]:e&&e.value?e.value:null})})},updateTerms(){j(this.taxonomy).then(e=>{this.terms=[],e.forEach(t=>{this.terms.push({value:t.id,label:t.name})})})},updateSelectedTerms(){this.selectedTerms=ee(this.taxonomy)}},async created(){await L(this.$.appContext.app)},mounted(){this.updateTerms(),this.updateSelectedTerms(),this.$bus.$on("updateSelectedTerms",this.updateSelectedTerms)},beforeUnmount(){this.$bus.$off("updateSelectedTerms",this.updateSelectedTerms)}},re={key:0,class:"aioseo-primary-term-select"},oe={class:"aioseo-primary-term-select__title"},se={class:"aioseo-primary-term-select__title-text"};function ne(e,t,r,o,s,n){const i=m("svg-circle-question-mark"),a=m("core-tooltip"),S=m("base-select");return 1<this.selectedTerms.length?(w(),T("div",re,[d("div",oe,[d("span",se,y(n.labelString),1),c(a,{offset:"-50px,0"},{tooltip:h(()=>[$(y(s.strings.tooltip),1)]),default:h(()=>[c(i)]),_:1})]),c(S,{size:"medium",options:n.options,modelValue:s.term,"onUpdate:modelValue":t[0]||(t[0]=b=>n.setPrimaryTerm(b))},null,8,["options","modelValue"])])):P("",!0)}const ie=g(te,[["render",ne]]);const ae={components:{PrimaryTerm:ie},props:{taxonomy:String}},me={class:"aioseo-app aioseo-primary-term"};function ce(e,t,r,o,s,n){const i=m("primary-term");return w(),T("div",me,[c(i,{taxonomy:r.taxonomy},null,8,["taxonomy"])])}const pe=g(ae,[["render",ce]]);if(l()&&window.wp){const{createElement:e,Fragment:t}=window.wp.element,{addFilter:r}=window.wp.hooks,{createHigherOrderComponent:o}=window.wp.compose,{subscribe:s}=window.wp.data;r("editor.PostTaxonomyType","aioseo/primary-term",o(n=>i=>{const{slug:a}=i;return Z(a)?e(t,{},e(n,i),e("div",{id:`aioseo-primary-term-${a}`},e("div",{className:"aioseo-primary-term-app",taxonomy:a}))):e(n,i)},"withInspectorControls")),s(()=>{window.aioseoBus.$emit("updateSelectedTerms")})}O()&&u().forEach(e=>{const t=document.querySelector(`#${e.name}div .inside`);if(!t)return;const r=document.createElement("div");r.setAttribute("id",`aioseo-primary-term-${e.slug}`),r.setAttribute("class","aioseo-primary-term-app"),r.setAttribute("taxonomy",e.slug),t.append(r),function(o){o(`#${e.name}checklist`).on("change",'input[type="checkbox"]',()=>{window.aioseoBus.$emit("updateSelectedTerms")}),o(`#${e.name}checklist`).on("wpListAddEnd",()=>{window.aioseoBus.$emit("updateSelectedTerms")})}(window.jQuery)});const f=e=>{if(!e)return;const t=e.getAttribute("taxonomy");let r=k(pe,{taxonomy:t});r=A(r),r=B(r),r=I(r),_._vm=r,r.use(_),r.mount(e)};if(N()&&window.aioseo&&window.aioseo.currentPost&&window.aioseo.currentPost.context==="post"){const e=document.getElementsByClassName("aioseo-primary-term-app");Array.prototype.forEach.call(e,t=>f(t)),C(".aioseo-primary-term-app","aioseoPrimaryTerm"),document.addEventListener("animationstart",function(t){t.animationName==="aioseoPrimaryTerm"&&f(t.target)},{passive:!0})}
